<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vraj Clicker 2</title>
    <link rel="icon" type="image/png" href="image_0.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; background: #070b14; color: #e2e8f0; margin: 0; height: 100vh; overflow: hidden; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .game-grid { display: grid; grid-template-columns: 350px 1fr 350px; height: 100vh; gap: 1rem; padding: 1rem; }
        .scroll-panel { overflow-y: auto; height: 100%; scrollbar-width: thin; scrollbar-color: #3b82f6 transparent; }
        .scroll-panel::-webkit-scrollbar { width: 4px; }
        .scroll-panel::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
        .click-btn-container { transition: transform 0.05s active; cursor: pointer; user-select: none; position: relative; }
        .click-btn-container:active { transform: scale(0.95); }
        .click-img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; pointer-events: none; }
        .upgrade-card { transition: all 0.2s; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .upgrade-card:hover:not(.disabled) { background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3); }
        .upgrade-card.disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
        .hidden { display: none !important; }
        .no-select { -webkit-user-select: none; user-select: none; }
        .bulk-btn.active { background: #3b82f6; color: white; }

        /* Floating Text Animation */
        .float-text {
            position: absolute; color: #60a5fa; font-weight: 800; pointer-events: none;
            animation: floatUp 0.8s ease-out forwards; z-index: 100;
        }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
    </style>
</head>
<body class="no-select">

    <div id="auth-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass p-8 rounded-3xl shadow-2xl w-full max-w-md text-center">
            <h1 class="text-4xl font-extrabold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">Vraj Clicker 2</h1>
            <div id="auth-tabs" class="flex mb-6 bg-gray-800/50 rounded-lg p-1">
                <button onclick="switchTab('login')" id="tab-login" class="flex-1 py-2 rounded-md font-semibold bg-blue-600">Login</button>
                <button onclick="switchTab('signup')" id="tab-signup" class="flex-1 py-2 rounded-md font-semibold text-gray-400">Sign Up</button>
            </div>
            <div id="login-form" class="space-y-4">
                <input type="email" id="li-email" placeholder="Email" class="w-full p-4 rounded-xl bg-gray-900 border border-gray-700 outline-none">
                <input type="password" id="li-password" placeholder="Password" class="w-full p-4 rounded-xl bg-gray-900 border border-gray-700 outline-none">
                <button onclick="handleLogin()" class="w-full bg-blue-600 p-4 rounded-xl font-bold">Enter Game</button>
                <button onclick="handleGuest()" class="w-full bg-gray-700 p-4 rounded-xl font-bold text-sm">Play as Guest</button>
            </div>
            <div id="signup-form" class="hidden space-y-4">
                <input type="text" id="su-username" placeholder="Username" class="w-full p-4 rounded-xl bg-gray-900 border border-gray-700 outline-none">
                <input type="email" id="su-email" placeholder="Email" class="w-full p-4 rounded-xl bg-gray-900 border border-gray-700 outline-none">
                <input type="password" id="su-password" placeholder="Password" class="w-full p-4 rounded-xl bg-gray-900 border border-gray-700 outline-none">
                <button onclick="handleSignup()" class="w-full bg-emerald-600 p-4 rounded-xl font-bold">Create Account</button>
            </div>
            <div id="verify-notice" class="hidden py-6">
                <h2 class="text-xl font-bold text-yellow-400">Check Email</h2>
                <button onclick="location.reload()" class="bg-blue-600 p-3 rounded-xl font-bold w-full mt-4">I've Verified</button>
            </div>
        </div>
    </div>

    <div id="game-screen" class="hidden h-screen">
        <div class="game-grid">
            <div class="glass rounded-3xl flex flex-col overflow-hidden">
                <div class="p-4 border-b border-white/10 bg-white/5 space-y-3">
                    <h3 class="font-bold text-blue-400 flex items-center gap-2">ğŸª Vraj Shop</h3>
                    <div class="flex bg-black/40 rounded-lg p-1 text-[10px] font-bold">
                        <button onclick="setBulk(1)" id="bulk-1" class="bulk-btn flex-1 py-1 rounded active">1X</button>
                        <button onclick="setBulk(10)" id="bulk-10" class="bulk-btn flex-1 py-1 rounded">10X</button>
                        <button onclick="setBulk(100)" id="bulk-100" class="bulk-btn flex-1 py-1 rounded">100X</button>
                    </div>
                </div>
                <div id="shop-list" class="scroll-panel p-4 space-y-3"></div>
            </div>

            <div class="flex flex-col items-center justify-between py-8 text-center relative">
                <div>
                    <h2 id="score" class="text-7xl font-black text-blue-400 drop-shadow-lg">0</h2>
                    <p id="vps-display" class="text-emerald-400 font-bold tracking-widest text-sm">0 VPS</p>
                </div>

                <div id="clicker-container" onclick="clickVraj(event)" class="click-btn-container w-80 h-80 rounded-full p-1 bg-gradient-to-tr from-blue-500 via-purple-500 to-pink-500 shadow-2xl">
                    <div class="w-full h-full rounded-full overflow-hidden border-8 border-[#070b14]">
                        <img src="image_0.png" class="click-img">
                    </div>
                </div>

                <div class="w-full max-w-xs space-y-4">
                    <div class="glass p-3 rounded-2xl text-xs text-gray-400">User: <span id="user-display" class="text-blue-300 font-bold">...</span></div>
                    <button onclick="logoutAction()" class="text-red-500/40 hover:text-red-500 text-xs font-bold underline">Logout</button>
                </div>
            </div>

            <div class="flex flex-col gap-4 overflow-hidden h-full">
                <div class="glass rounded-3xl flex-1 flex flex-col overflow-hidden">
                    <div class="p-4 border-b border-white/10 bg-white/5 font-bold text-purple-400">ğŸ† Leaderboard</div>
                    <div id="leaderboard-list" class="scroll-panel p-4 space-y-2"></div>
                </div>
                <div class="glass rounded-3xl flex-1 flex flex-col overflow-hidden">
                    <div class="p-4 border-b border-white/10 bg-white/5 font-bold text-emerald-400">ğŸ’¬ Chat</div>
                    <div id="chat-box" class="scroll-panel p-4 flex flex-col-reverse text-sm"></div>
                    <form id="chat-form" class="p-3 bg-white/5 border-t border-white/10 flex gap-2">
                        <input type="text" id="chat-input" placeholder="Type..." class="flex-grow bg-gray-900 border border-gray-700 p-2 rounded-lg text-xs outline-none">
                        <button class="bg-emerald-600 px-3 py-2 rounded-lg text-xs font-bold">Send</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInAnonymously, onAuthStateChanged, sendEmailVerification, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, addDoc, collection, query, orderBy, limit, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDwg2ZSpQspAD-o19AZCOHcrl9VnYc_sdk",
            authDomain: "vraj-clicker-2.firebaseapp.com",
            projectId: "vraj-clicker-2",
            storageBucket: "vraj-clicker-2.firebasestorage.app",
            messagingSenderId: "162243172716",
            appId: "1:162243172716:web:874a1f8be471a9f0d83b49"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const clickSound = new Audio('click.mp3');
        function playSfx() { clickSound.currentTime = 0; clickSound.play().catch(()=>{}); }

        let score = 0, vps = 0, bulkAmount = 1;
        let currentUser = null, currentUsername = "Guest";

        const upgradeData = [
  { name: "Vraj Finger",      baseCost: 10,         basePower: 0.2,      emoji: "â˜ï¸" },
  { name: "Vraj Sprout",      baseCost: 20,         basePower: 0.4,      emoji: "ğŸŒ±" },
  { name: "Vraj Cursor",      baseCost: 50,         basePower: 1,        emoji: "ğŸ–±ï¸" },
  { name: "Vraj Nanobots",    baseCost: 80,         basePower: 2,        emoji: "ğŸ¤" },
  { name: "Vraj Drone",       baseCost: 120,        basePower: 4,        emoji: "ğŸš" },
  { name: "Vraj Magnet",      baseCost: 210,        basePower: 6,        emoji: "ğŸ§²" },
  { name: "Vraj Juice",       baseCost: 336,        basePower: 10,       emoji: "ğŸ§ƒ" },
  { name: "Vraj Keyboard",    baseCost: 538,        basePower: 15,       emoji: "âŒ¨ï¸" },
  { name: "Vraj Potion",      baseCost: 861,        basePower: 30,       emoji: "ğŸ§ª" },
  { name: "Vraj Coffee",      baseCost: 1378,       basePower: 50,       emoji: "â˜•" },
  { name: "Vraj Gear",        baseCost: 2205,       basePower: 100,      emoji: "âš™ï¸" },
  { name: "Vraj Botnet",      baseCost: 3528,       basePower: 120,      emoji: "ğŸŒ" },

  { name: "Vraj Tuner",       baseCost: 5645,       basePower: 150,      emoji: "ğŸšï¸" },
  { name: "Vraj Garden",      baseCost: 9032,       basePower: 170,      emoji: "ğŸŒ¿" },
  { name: "Vraj Typist",      baseCost: 14451,      basePower: 200,      emoji: "ğŸ’»" },
  { name: "Vraj Swarm",       baseCost: 23122,      basePower: 250,      emoji: "ğŸ" },
  { name: "Vraj Automaton",   baseCost: 36995,      basePower: 280,      emoji: "ğŸ¤–" },
  { name: "Vraj Attractor",   baseCost: 59192,      basePower: 296,      emoji: "ğŸ§²" },
  { name: "Vraj Smoothie",    baseCost: 94707,      basePower: 474,      emoji: "ğŸ¥¤" },
  { name: "Vraj Console",     baseCost: 151531,     basePower: 758,      emoji: "ğŸ•¹ï¸" },
  { name: "Vraj Lab",         baseCost: 242450,     basePower: 1212,     emoji: "âš—ï¸" },
  { name: "Vraj Brewery",     baseCost: 387920,     basePower: 1940,     emoji: "ğŸº" },
  { name: "Vraj Workshop",    baseCost: 620672,     basePower: 3103,     emoji: "ğŸ› ï¸" },
  { name: "Vraj Network",     baseCost: 993075,     basePower: 4965,     emoji: "ğŸ“¡" },

  { name: "Vraj Reactor",     baseCost: 1588920,    basePower: 7945,     emoji: "âš›ï¸" },
  { name: "Vraj Meadow",      baseCost: 2542272,    basePower: 12711,    emoji: "ğŸŒ¾" },
  { name: "Vraj Terminal",    baseCost: 4067635,    basePower: 20338,    emoji: "ğŸ–¥ï¸" },
  { name: "Vraj Hive",        baseCost: 6508216,    basePower: 32541,    emoji: "ğŸœ" },
  { name: "Vraj Factory",     baseCost: 10413146,   basePower: 52066,    emoji: "ğŸ­" },
  { name: "Vraj Collider",    baseCost: 16661034,   basePower: 83305,    emoji: "ğŸ”¬" },
  { name: "Vraj Extract",     baseCost: 26657654,   basePower: 133288,   emoji: "ğŸ§‰" },
  { name: "Vraj Deck",        baseCost: 42652246,   basePower: 213261,   emoji: "ğŸ®" },
  { name: "Vraj Chemworks",   baseCost: 68243594,   basePower: 341218,   emoji: "ğŸ§«" },
  { name: "Vraj Distillery",  baseCost: 109189750,  basePower: 545949,   emoji: "ğŸ¥ƒ" },
  { name: "Vraj Assembly",    baseCost: 174703600,  basePower: 873518,   emoji: "ğŸ¤" },
  { name: "Vraj Mainframe",   baseCost: 279525760,  basePower: 1397629,  emoji: "ğŸ’½" },

  { name: "Vraj Singularity", baseCost: 447241216,  basePower: 2236206,  emoji: "ğŸŒ€" },
  { name: "Vraj Forest",      baseCost: 715585946,  basePower: 3577930,  emoji: "ğŸŒ²" },
  { name: "Vraj Supercomp",   baseCost: 1144937514, basePower: 5724688,  emoji: "ğŸ’¾" },
  { name: "Vraj Colony",      baseCost: 1831900022, basePower: 9159501,  emoji: "ğŸœ" },
  { name: "Vraj Megaplant",   baseCost: 2931040035, basePower: 14655200, emoji: "ğŸ—ï¸" },
  { name: "Vraj Accelerator", baseCost: 4689664056, basePower: 23448320, emoji: "ğŸš€" },
  { name: "Vraj Serum",       baseCost: 7503462490, basePower: 37517312, emoji: "ğŸ’‰" },
  { name: "Vraj Interface",   baseCost: 12005539984,basePower: 60027700, emoji: "ğŸ§©" },
  { name: "Vraj Genome",      baseCost: 19208863974,basePower: 96044320, emoji: "ğŸ§¬" },
  { name: "Vraj Roast",       baseCost: 30734182358,basePower: 153670912,emoji: "ğŸŒ°" },
  { name: "Vraj Forge",       baseCost: 49174691773,basePower: 245873459,emoji: "ğŸ—œï¸" },
  { name: "Vraj Datasphere",  baseCost: 78679506837,basePower: 393397534,emoji: "ğŸŒ" }
        ];

        const upgrades = [];
        for(let i=0; i<50; i++) {
            let base = upgradeData[i] || { 
                name: "Vraj Galaxy T-" + (i+1), 
                baseCost: Math.floor(upgrades[i-1].cost * 6), 
                basePower: Math.floor(upgrades[i-1].power * 7), 
                emoji: "ğŸŒŒ" 
            };
            upgrades.push({ id: i+1, name: base.name, cost: base.baseCost, power: base.basePower, emoji: base.emoji });
        }

        window.setBulk = (amt) => {
            bulkAmount = amt;
            document.querySelectorAll('.bulk-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('bulk-'+amt).classList.add('active');
            updateUI();
        };

        function getBulkCost(baseCost, count) {
            let total = 0; let temp = baseCost;
            for(let i=0; i<count; i++) { total += temp; temp = Math.ceil(temp * 1.15); }
            return total;
        }

        window.buyUpgrade = (id) => {
            const upg = upgrades.find(u => u.id === id);
            const cost = getBulkCost(upg.cost, bulkAmount);
            if (score >= cost) {
                score -= cost;
                vps += (upg.power * bulkAmount);
                for(let i=0; i<bulkAmount; i++) { upg.cost = Math.ceil(upg.cost * 1.15); }
                updateUI(); playSfx();
            }
        };

        window.clickVraj = (e) => {
            score += 1; playSfx(); updateUI();
            const rect = document.getElementById('clicker-container').getBoundingClientRect();
            const text = document.createElement('div');
            text.className = 'float-text';
            text.innerText = '+1';
            text.style.left = (e.clientX - 10) + 'px';
            text.style.top = (e.clientY - 20) + 'px';
            document.body.appendChild(text);
            setTimeout(() => text.remove(), 800);
        };

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score).toLocaleString();
            document.getElementById('vps-display').innerText = vps.toFixed(1).toLocaleString() + " VPS";
            upgrades.forEach(u => {
                const el = document.getElementById(`upg-${u.id}`);
                const bCost = getBulkCost(u.cost, bulkAmount);
                if (el) {
                    el.classList.toggle('disabled', score < bCost);
                    document.getElementById(`cost-${u.id}`).innerText = bCost.toLocaleString();
                }
            });
        }

        const shop = document.getElementById('shop-list');
        upgrades.forEach(u => {
            shop.innerHTML += `
                <div id="upg-${u.id}" onclick="buyUpgrade(${u.id})" class="upgrade-card glass p-4 rounded-2xl flex justify-between items-center disabled">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${u.emoji}</span>
                        <div><p class="font-bold text-sm text-white">${u.name}</p><p class="text-[10px] text-emerald-400">+${u.power.toLocaleString()} VPS</p></div>
                    </div>
                    <div class="text-right">
                        <p class="text-xs font-bold text-blue-300" id="cost-${u.id}">${u.cost.toLocaleString()}</p>
                        <p class="text-[9px] text-gray-600">pts</p>
                    </div>
                </div>`;
        });

        setInterval(() => { if (vps > 0) { score += (vps / 10); updateUI(); } }, 100);

        window.switchTab = (t) => {
            document.getElementById('login-form').classList.toggle('hidden', t !== 'login');
            document.getElementById('signup-form').classList.toggle('hidden', t !== 'signup');
            document.getElementById('tab-login').classList.toggle('bg-blue-600', t === 'login');
            document.getElementById('tab-signup').classList.toggle('bg-blue-600', t === 'signup');
        };

        window.handleSignup = async () => {
            const u = document.getElementById('su-username').value, e = document.getElementById('su-email').value, p = document.getElementById('su-password').value;
            try { const c = await createUserWithEmailAndPassword(auth, e, p); await setDoc(doc(db, "users", c.user.uid), { username: u }); await sendEmailVerification(c.user); alert("Check email!"); } catch (err) { alert(err.message); }
        };
        window.handleLogin = async () => { try { await signInWithEmailAndPassword(auth, document.getElementById('li-email').value, document.getElementById('li-password').value); } catch (err) { alert(err.message); } };
        window.handleGuest = () => signInAnonymously(auth);
        window.logoutAction = () => { if(confirm("Logout?")) signOut(auth); };

        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (user) {
                if (!user.isAnonymous && !user.emailVerified) {
                    document.getElementById('verify-notice').classList.remove('hidden');
                    document.getElementById('login-form').classList.add('hidden');
                    document.getElementById('auth-tabs').classList.add('hidden');
                } else {
                    document.getElementById('auth-screen').classList.add('hidden');
                    document.getElementById('game-screen').classList.remove('hidden');
                    if(user.isAnonymous) { currentUsername = "Guest_" + user.uid.substring(0,4); } 
                    else {
                        const snap = await getDoc(doc(db, "users", user.uid)); currentUsername = snap.exists() ? snap.data().username : "Vraj";
                        const save = await getDoc(doc(db, "leaderboard", user.uid)); if(save.exists()){ score = save.data().score || 0; vps = save.data().vps || 0; }
                    }
                    document.getElementById('user-display').innerText = currentUsername;
                    setInterval(() => { if(currentUser && !currentUser.isAnonymous) setDoc(doc(db, "leaderboard", currentUser.uid), { score, vps, username: currentUsername }, { merge: true }); }, 10000);
                    onSnapshot(query(collection(db, "leaderboard"), orderBy("score", "desc"), limit(10)), (s) => {
                        document.getElementById('leaderboard-list').innerHTML = s.docs.map((d, i) => `<div class="flex justify-between p-2 rounded bg-white/5 text-xs"><span>#${i+1} ${d.data().username}</span><span class="text-blue-400 font-bold">${Math.floor(d.data().score).toLocaleString()}</span></div>`).join('');
                    });
                    onSnapshot(query(collection(db, "globalChat"), orderBy("timestamp", "desc"), limit(20)), (s) => {
                        document.getElementById('chat-box').innerHTML = s.docs.map(d => `<div class="mb-1"><span class="text-emerald-400 font-bold">${d.data().username}:</span> ${d.data().text}</div>`).join('');
                    });
                }
            } else { document.getElementById('auth-screen').classList.remove('hidden'); document.getElementById('game-screen').classList.add('hidden'); }
        });

        document.getElementById('chat-form').onsubmit = async (e) => {
            e.preventDefault(); const input = document.getElementById('chat-input'); if(!input.value.trim()) return;
            await addDoc(collection(db, "globalChat"), { text: input.value, username: currentUsername, timestamp: serverTimestamp() }); input.value = "";
        };
    </script>
</body>
</html>
